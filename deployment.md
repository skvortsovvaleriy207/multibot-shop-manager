# Развертывание Multibot Shop Manager

Это руководство описывает процесс развертывания экосистемы из 3-х ботов (`bestsocialbot`, `investmentsbot`, `gifthealthbot`) на Linux-сервере с использованием Docker.

## Структура проекта

- **root/**: Содержит общие скрипты и конфигурацию Docker.
- **bestsocialbot/**: Код и настройки социального бота.
- **investmentsbot/**: Код и настройки инвестиционного бота.
- **gifthealthbot/**: Код и настройки бота здоровья.
- **shared_storage/**: Общая база данных (`global_users.db`) и общая логика.

## Предварительные требования

- **Docker** и **Docker Compose**, установленные на сервере.
- **Python 3.12** (опционально, если будете запускать скрипты вне Docker).

## Инструкция по установке

### 1. Перенос файлов
Скопируйте всю папку проекта на ваш сервер (например, в `/opt/multibot` или `~/multibot`).

### 2. Настройка переменных окружения
Вы должны проверить и обновить файл `.env` в папке **КАЖДОГО** бота перед запуском.

- `bestsocialbot/.env`
- `investmentsbot/.env`
- `gifthealthbot/.env`

**Чек-лист для каждого файла .env:**
- `MAIN_BOT_TOKEN`: Уникальный токен Telegram для конкретного бота.
- `ADMIN_ID`: Ваш числовой Telegram ID (можно получить у @userinfobot). **Критически важно для уведомлений об ошибках.**
- `CHANNEL_ID` / `CHANNEL_URL`: Данные канала для подписки.
- Настройки Google Sheets (`MAIN_GOOGLE_SHEET` и т.д.).

### 3. Google Credentials
Убедитесь, что файл `credentials.json` находится в корневой директории проекта. Этот файл используется всеми ботами для доступа к Google Таблицам.

### 4. Загрузка юридических документов (Только при первом запуске)
Если это чистая установка и база данных пуста, вам необходимо загрузить текстовые файлы документов в базу данных.

1. Создайте папку `temp/` в корне проекта.
2. Загрузите туда ваши текстовые файлы:
   - `temp/Политика конфиденциальности данных.txt`
   - `temp/Пользовательское соглашение.txt`
3. Запустите скрипт загрузки (требуется Python локально ИЛИ запуск внутри Docker):
   ```bash
   # Вариант А: Запуск внутри Docker (после старта контейнеров)
   docker compose run --rm bestsocialbot python load_legal_docs.py
   
   # Вариант Б: Локальный запуск (если установлен Python)
   pip install -r bestsocialbot/requirements.txt
   python3 load_legal_docs.py
   ```

### 5. Запуск ботов
Выполните следующую команду в корне проекта:

```bash
docker compose up -d
```

Эта команда соберет образы и запустит всех 3-х ботов в фоновом режиме.

**Полезные команды:**
- **Просмотр логов:** `docker compose logs -f`
- **Перезапуск конкретного бота:** `docker compose restart bestsocialbot`
- **Остановка всех ботов:** `docker compose down`

## Скрипты обслуживания

### Очистка списка пользователей
Чтобы удалить все данные пользователей (но сохранить юридические документы) из общей базы данных, выполните:

```bash
# Внутри Docker
docker compose run --rm bestsocialbot python clear_global_users.py
```
**Внимание:** Эта операция необратима.

### Обновление юридических документов
Если вы изменили текст документов, просто поместите новые версии файлов в папку `temp/` и снова запустите `load_legal_docs.py`.

## Устранение неполадок

- **Ошибка "Chat not found"**: Обычно означает, что `ADMIN_ID` в файле `.env` установлен в 0 или неверен. Обновите его и перезапустите бота.
- **Ошибки Google Sheets**: Проверьте права доступа и валидность файла `credentials.json`.
- **Блокировки базы данных**: Поскольку `sqlite` основан на файлах, при высокой нагрузке возможны временные блокировки, но библиотека `aiosqlite` справляется с этим в нормальном режиме работы.
